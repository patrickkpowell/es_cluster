---
# tasks file for roles/create_cluster_token
- name: Create kibana user and get password
  ansible.builtin.shell:
    cmd: "/usr/share/elasticsearch/bin/elasticsearch-reset-password -u {{kib_user}} -ab | awk -F': ' '{print $2}'"
  register: kib_password
  when: inventory_hostname in groups['cert_node'] 
  tags:
    - create
    - debug

- name: Print kibana password
  ansible.builtin.debug:
    msg: '{{kib_password.stdout}}'
  tags:
    - create
    - debug

- name: Export password
  set_fact:
    kib_password: '{{kib_password}}'
  delegate_facts: true
  delegate_to: '{{item}}'
  with_items:
    - "{{groups['kibana_nodes']}}"
  tags:
    - create
    - debug
    

